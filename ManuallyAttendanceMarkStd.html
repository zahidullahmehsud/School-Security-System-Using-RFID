<!DOCTYPE html>

<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <title>ManuallyAttendanceMarkByTeacher</title>
  <link rel="stylesheet" href="Dashboard.css" />
  <link rel="stylesheet" href="styles/sidebar.css">
  <link rel="stylesheet" href="styles/card_leave_Attendance_Records.css">
  <!-- Boxicons CDN Link -->
  <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" /> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
 
</head>

<body>
  <div class="sidebar">
    
    <ul class="nav-links">
      <li>
        <a href="Dashboard.html" class="active">
          <i class="bx bx-grid-alt"></i>
          <span class="link_name">Dashboard</span>
        </a>
       
      </li>
      <li>
        <div class="iocn-link">
          <a href="">
            <i class="fa fa-users" aria-hidden="true"></i>
            <span class="link_name">Teacher Management</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="#">Category</a></li>
          <li><a href="insertTeacherData.html">Teacher Registration</a></li>
          <li><a href="teacherRecord.html">Teachers Record</a></li>
          <li><a href="Attendance.html">Attendance</a></li>
          <li><a href="ManuallyAttendanceMarkStd.html">Manual Attenedance</a></li>
          <li><a href="LeaveRequests.html">Leave Requests</a></li>
          <li><a href="TeacherCardRequest.html">Card Requests</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="#">
            <i class="fa fa-graduation-cap" aria-hidden="true"></i>
            <span class="link_name">Student Management</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
         
          <li><a href="InsertStdData.html">Student Registration</a></li>
          <li><a href="StudentRecord.html">Students Record</a></li>
          <li><a href="StudentNewCardRequests.html">Card Requests</a></li>
        </ul>
      </li>
    
      <li>
        <a href="securityOfficer.html">
          <i class="fas fa-shield"></i>
          <span class="link_name">Security Officer</span>
        </a>
      
      </li>
      <li>
        <a href="setSchoolTiming.html">
          <i class="fas fa-clock"></i>
          <span class="link_name">Set School Timing</span>
        </a>
      </li>
      <li>
        <a href="map.html">
          <i class="fas fa-map-marker-alt"></i>
          <span class="link_name">Select School Area</span>
        </a>
      </li>
      <li>
      </ul>
      <a href="index.html" >
        <div class="profile-details">
          <div class="profile-content">
            <img src="website_log.png" alt="profileImg">
          </div>
          <div class="name-job">
            <div class="profile_name">Admin</div>
            <div class="job">Log out</div>
          </div>
          <i class='bx bx-log-out' style="color: #fff; font-size: 30px;"></i>
        </div>
      </a>

  </div>
  <div class="main-content">

    <section class="home-section">

      <nav>
        <div class="profile-details" style="width: 50px;  ">
        <span class="admin_name">Manual Attendance  <i class="fas fa-user-check"></i></span>
        </div>
       
    
  
      <div class="logo-details">
     
      
        <img src="website_log.png" alt="Website Logo" style="width: 50px; display: block; margin: 0 auto; ">
  
        <div>
          <span style="display: block; text-align: center; color:black; font-weight: bold;">School Security System</span>
    
        </div>
     
        
      </div>
        <div class="profile-details">
            
          <span class="admin_name">Admin Pannel <i class="fa fa-user-circle"></i>
          </span>
         
        </div>
  
      </nav>

      <div class="home-content">
        <div class="container">
         
          <div class="filter-container">
            <label for="dateFilter"></label>
            <input type="date" id="dateFilter">
            <button onclick="filterAttendance()" style="margin-left: 10px;" id="applyFilter" >Filter <i class="fa fa-filter"></i></button>
          </div>
          <table id="attendanceTable">
            <thead>
              <tr>
                <th>Teacher ID</th>
                <th>Teacher Name</th>
                <th>Student Name</th>
                
                <th>Class</th>
                <th>Time</th>
                
              </tr>
            </thead>
            <tbody id="attendanceBody"></tbody>
          </table>
        </div>
        <div id="noRecordMessage" style="text-align: center; color: red; margin-top: 10px; display: none;"></div>

      </div>
     

      <style>
        /* Add this to your existing styles or in a new stylesheet */
     



     
      </style>
  </div>
  </section>
  <script src="./scripts/sidebar.js"></script>
  <script type="module">


   
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";
    

    const firebaseConfig = {
      apiKey: "AIzaSyDCXvbE44rMmYlkSLMIsramC6tiBcLBNH4",
      authDomain: "schoolsecuritysystemusin-4c8fa.firebaseapp.com",
      databaseURL: "https://schoolsecuritysystemusin-4c8fa-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "schoolsecuritysystemusin-4c8fa",
      storageBucket: "schoolsecuritysystemusin-4c8fa.appspot.com",
      messagingSenderId: "58102931592",
      appId: "1:58102931592:web:8b2a5aee4664b3df023f3d",
      measurementId: "G-KTK6CHM7EF"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
   
    import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
    const db = getDatabase();
   

   


    const attendanceRef = ref(db, 'AttendanceRecord/StudentAttendance');

// Function to fetch and display attendance data
function filterAttendance() {
    const selectedDateElement = document.getElementById('dateFilter');
    const selectedDate = selectedDateElement.value;
    const formattedSelectedDate = formatDate(selectedDate);

    const attendanceBody = document.getElementById('attendanceBody');
    attendanceBody.innerHTML = '';

    const noRecordMessage = document.getElementById('noRecordMessage');
    noRecordMessage.style.display = 'none';

    get(attendanceRef).then((classSnapshot) => {
        let recordsFound = false; // Flag to check if records are found

        classSnapshot.forEach((classData) => {
            const className = classData.key;
            const datesSnapshot = classData.val();

            if (datesSnapshot[formattedSelectedDate]) {
                const studentsData = datesSnapshot[formattedSelectedDate];

                Object.keys(studentsData).forEach((studentID) => {
                    const studentData = studentsData[studentID];

                    if (studentData.type === 'Manual') {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${studentID}</td>
                            <td>${studentData.teachername}</td>
                            <td>${studentData.firstName} ${studentData.lastName}</td>
                          
                            <td>${className}</td>
                            <td>${studentData.time}</td>
                        `;
                        attendanceBody.appendChild(row);

                        recordsFound = true;
                    }
                });
            }
        });

        if (!recordsFound) {
            // Display a message if no records are found for the selected date
            noRecordMessage.innerHTML = `No records found for ${selectedDate}.`;
            noRecordMessage.style.display = 'block';
        }
    });
}

// Function to format the date to match the data structure
function formatDate(inputDate) {
  const dateParts = inputDate.split('-');
  const day = parseInt(dateParts[2], 10).toString().padStart(2, '0');
  const month = parseInt(dateParts[1], 10).toString().padStart(2, '0');

  return `${day}-${month}-${dateParts[0]}`;
}


function getCurrentDate() {
        const today = new Date();
        const day = today.getDate().toString().padStart(2, '0');
        const month = (today.getMonth() + 1).toString().padStart(2, '0');
        const year = today.getFullYear();
        return `${year}-${month}-${day}`;
      }

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('dateFilter').value = getCurrentDate();
      filterAttendance();
      const filterButton = document.getElementById('applyFilter');
      filterButton.addEventListener('click', function () {
        filterAttendance();
        const currentLocation = window.location.href;
        const navLinks = document.querySelectorAll(".nav-links li a");

        navLinks.forEach((link) => {
          if (link.href === currentLocation) {
            link.classList.add("active");
          }
        });
      
      });
      
      const dropdownButtons = document.querySelectorAll('.nav-dropdown-btn');
    dropdownButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            const content = this.nextElementSibling;
            const isOpen = content.style.display === 'block';
            content.style.display = isOpen ? 'none' : 'block';

            // Store the state in sessionStorage
            const dropdownId = this.getAttribute('data-dropdown-id');
            sessionStorage.setItem(`dropdown-${dropdownId}`, isOpen ? 'closed' : 'open');
        });

        // Check the sessionStorage to set the initial state
        const dropdownId = button.getAttribute('data-dropdown-id');
        const storedState = sessionStorage.getItem(`dropdown-${dropdownId}`);
        if (storedState === 'open') {
            const content = button.nextElementSibling;
            content.style.display = 'block';
            
        }
    });

    });
    

  </script>

</body>

</html>