<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Record</title>
  <style>

  </style>
 
  <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="Dashboard.css">
  <link rel="stylesheet" href="styles/card_leave_Attendance_Records.css">
  <link rel="stylesheet" href="styles/sidebar.css">

</head>

<body>
  <div class="sidebar">
    
    <ul class="nav-links">
      <li>
        <a href="Dashboard.html" class="active">
          <i class="bx bx-grid-alt"></i>
          <span class="link_name">Dashboard</span>
        </a>
       
      </li>
      <li>
        <div class="iocn-link">
          <a href="">
            <i class="fa fa-users" aria-hidden="true"></i>
            <span class="link_name">Teacher Management</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="#">Category</a></li>
          <li><a href="insertTeacherData.html">Teacher Registration</a></li>
          <li><a href="teacherRecord.html">Teachers Record</a></li>
          <li><a href="Attendance.html">Attendance</a></li>
          <li><a href="ManuallyAttendanceMarkStd.html">Manual Attenedance</a></li>
          <li><a href="LeaveRequests.html">Leave Requests</a></li>
          <li><a href="TeacherCardRequest.html">Card Requests</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="#">
            <i class="fa fa-graduation-cap" aria-hidden="true"></i>
            <span class="link_name">Student Management</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
         
          <li><a href="InsertStdData.html">Student Registration</a></li>
          <li><a href="StudentRecord.html">Students Record</a></li>
          <li><a href="StudentNewCardRequests.html">Card Requests</a></li>
        </ul>
      </li>
    
      <li>
        <a href="securityOfficer.html">
          <i class="fas fa-shield"></i>
          <span class="link_name">Security Officer</span>
        </a>
      
      </li>
      <li>
        <a href="setSchoolTiming.html">
          <i class="fas fa-clock"></i>
          <span class="link_name">Set School Timing</span>
        </a>
      </li>
      <li>
        <a href="map.html">
          <i class="fas fa-map-marker-alt"></i>
          <span class="link_name">Select School Area</span>
        </a>
      </li>
      <li>
      </ul>
      <a href="index.html" >
        <div class="profile-details">
          <div class="profile-content">
            <img src="website_log.png" alt="profileImg">
          </div>
          <div class="name-job">
            <div class="profile_name">Admin</div>
            <div class="job">Log out</div>
          </div>
          <i class='bx bx-log-out' style="color: #fff; font-size: 30px;"></i>
        </div>
      </a>

  </div>


  <section class="home-section">

    <nav>
      <div class="profile-details" style="width: 50px;  ">
        <span class="admin_name">Student Record <i class="fa fa-table" aria-hidden="true"></i></span>
      </div>
      <div class="logo-details">
     
      
        <img src="website_log.png" alt="Website Logo" style="width: 50px; display: block; margin: 0 auto; ">
  
        <div>
          <span style="display: block; text-align: center; color:black; font-weight: bold;">School Security System</span>
    
        </div>
     
        
      </div>
      <div class="profile-details">

        <span class="admin_name">Admin Pannel <i class="fa fa-user-circle"></i>
        </span>

      </div>
    </nav>

    <div class="home-content">

      <div class="filter-container">
        <label for="filterType"></label>
        <select id="filterType">
          <option value="all">All Classes</option>
          <option value="1">Class 1</option>
          <option value="2">Class 2</option>
          <option value="3">Class 3</option>
          <option value="4">Class 4</option>
          <option value="5">Class 5</option>
          <option value="6">Class 6</option>
          <option value="7">Class 7</option>
          <option value="8">Class 8</option>
          <option value="9">Class 9</option>
          <option value="10">Class 10</option>

        </select>
        <button type="button" id="applyFilter">Filter <i class="fa fa-filter"></i></button>
      </div>


      <div id="idList2">
        <table id="dataTable" class="container">
          <thead>
            <tr>
              <th>ID</th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Father Name</th>
              <th>Class</th>
              <th>Gender</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="dataBody"></tbody>
        </table>
      </div>

      <style>
.button-container {
  text-align: center; /* Center-align the buttons */
  padding-top: 6px;
}
      </style>
     
      <p id="noRecordsMessage" style="color: red;"></p>

    </div>
    </div>

    <script src="FilteringByClass.js"></script>
    <script src="./scripts/sidebar.js"></script>
    <script type="module">


      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      //web app's Firebase configuration
      // For Firebase JS SDK 
      const firebaseConfig = {
        apiKey: "AIzaSyDCXvbE44rMmYlkSLMIsramC6tiBcLBNH4",
        authDomain: "schoolsecuritysystemusin-4c8fa.firebaseapp.com",
        databaseURL: "https://schoolsecuritysystemusin-4c8fa-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "schoolsecuritysystemusin-4c8fa",
        storageBucket: "schoolsecuritysystemusin-4c8fa.appspot.com",
        messagingSenderId: "58102931592",
        appId: "1:58102931592:web:8b2a5aee4664b3df023f3d",
        measurementId: "G-KTK6CHM7EF"
      };

     
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      
      import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
      const db = getDatabase();


      const idList2 = document.querySelector("#idList2");


      document.getElementById('applyFilter').addEventListener('click', filterRecords);

      function filterRecords() {
        const selectedClass = document.getElementById('filterType').value;
        displayEnteredIds(selectedClass);
      }

     
      function displayEnteredIds(selectedClass) {
  const dataBody = document.querySelector("#dataBody");
  dataBody.innerHTML = "";

  let recordsFound = false;

  get(ref(db, "StudentData"))
    .then((snapshot) => {
      if (snapshot.exists()) {
        snapshot.forEach((childSnapshot) => {
          const data = childSnapshot.val();

          // Iterate over all objects within the data object
          for (const innerDataKey in data) {
            if (data.hasOwnProperty(innerDataKey)) {
              const innerData = data[innerDataKey];

              // Extract values from the innermost nested object
              const id = innerData.ID;
              const firName = innerData.firstname;
              const lasName = innerData.lastname;
              const FatherName = innerData.fName;
              const ClassName = innerData.cName;
              const gender = innerData.gen;
              const fathercnic = innerData.cnic;

              // Check if the record matches the selected class filter
              if (selectedClass === 'all' || selectedClass === ClassName) {
                recordsFound = true;
                const tableRow = document.createElement("tr");

                tableRow.innerHTML =
                  `<td>${id}</td>
                  <td>${firName}</td>
                  <td>${lasName}</td>
                  <td>${FatherName}</td>
                  <td>${ClassName}</td>
                  <td>${gender}</td>
                  <td>
                    <div class="button-container"> 
                      <a class="edit-button" href="EditStudent.html?id=${id}&firstName=${firName}&lastName=${lasName}&fatherName=${FatherName}&className=${ClassName}&gender=${gender}&cnic=${fathercnic}">
                        <button class="action-button edit">Edit <i class='fa fa-edit'></i></button>    
                      </a>
                      <button id="delete-button" class="delete-button" data-id="${id}" class-data=${ClassName} cnic-data=${fathercnic}>Delete <i class="fa fa-trash" aria-hidden="true"></i></button>
                    </div>
                  </td>
                `;
                dataBody.appendChild(tableRow);
              }
            }
          }
        });

        if (!recordsFound) {
          // No records found, display the styled message with the selected class name
          const noRecordsMessage = document.querySelector("#noRecordsMessage");
          noRecordsMessage.textContent = "No records found for the class: " + selectedClass;
          noRecordsMessage.style.display = "block"; // Show the message
        } else {
          // Records found, clear the message and hide it
          document.querySelector("#noRecordsMessage").textContent = "";
        }

        // Add event listeners for delete buttons
        const deleteButtons = document.querySelectorAll(".delete-button");
        deleteButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const id = button.getAttribute("data-id");
            const cl = button.getAttribute("class-data");
            const cnic = button.getAttribute("cnic-data")
            alert(cnic)
            deleteStudent(id, button, cl, cnic); // Pass the button element
          });
        });
      }
    })
    .catch((error) => {
      alert(error);
    });
}


      function deleteStudent(id, button, cl , cnic) {

        if (confirm("Are you sure you want to delete this student?")) {
          // Remove the data from Firebase
          remove(ref(db, "StudentData/" +cnic+"/"+ id))
          remove(ref(db, "ClassRoom/" + cl + "/Students/" + id))
          remove(ref(db, "allowed-card-ids/" + id))
            .then(() => {
              
              const rowToDelete = button.closest("tr"); 
              if (rowToDelete) {
                rowToDelete.remove();
                alert("Student record deleted successfully");
              } else {
                alert("Student record not found in the table");
              }
            })
            .catch((error) => {
              alert("Error deleting student record: " + error);
            });
        }
      }
      ///////////////////////////////////////////////////////////////////////////
      const dropdownButtons = document.querySelectorAll('.nav-dropdown-btn');
    dropdownButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            const content = this.nextElementSibling;
            const isOpen = content.style.display === 'block';
            content.style.display = isOpen ? 'none' : 'block';

            // Store the state in sessionStorage
            const dropdownId = this.getAttribute('data-dropdown-id');
            sessionStorage.setItem(`dropdown-${dropdownId}`, isOpen ? 'closed' : 'open');
        });

        // Check the sessionStorage to set the initial state
        const dropdownId = button.getAttribute('data-dropdown-id');
        const storedState = sessionStorage.getItem(`dropdown-${dropdownId}`);
        if (storedState === 'open') {
            const content = button.nextElementSibling;
            content.style.display = 'block';
            
        }
    });



      // Display all records initially
      displayEnteredIds('all');
      updateBtn.addEventListener('click', UpdateData);

    </script>
</body>

</html>