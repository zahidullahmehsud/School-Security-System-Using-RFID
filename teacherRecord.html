<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Record</title>

  <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  

  <link rel="stylesheet" href="Dashboard.css">
  <link rel="stylesheet" href="styles/Dashboard.css">
  <link rel="stylesheet" href="styles/card_leave_Attendance_Records.css">
  <link rel="stylesheet" href="styles/sidebar.css" >


<body>
  <div class="sidebar">
    
    <ul class="nav-links">
      <li>
        <a href="Dashboard.html" class="active">
          <i class="bx bx-grid-alt"></i>
          <span class="link_name">Dashboard</span>
        </a>
       
      </li>
      <li>
        <div class="iocn-link">
          <a href="">
            <i class="fa fa-users" aria-hidden="true"></i>
            <span class="link_name">Teacher Management</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="#">Category</a></li>
          <li><a href="insertTeacherData.html">Teacher Registration</a></li>
          <li><a href="teacherRecord.html">Teachers Record</a></li>
          <li><a href="Attendance.html">Attendance</a></li>
          <li><a href="ManuallyAttendanceMarkStd.html">Manual Attenedance</a></li>
          <li><a href="LeaveRequests.html">Leave Requests</a></li>
          <li><a href="TeacherCardRequest.html">Card Requests</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="#">
            <i class="fa fa-graduation-cap" aria-hidden="true"></i>
            <span class="link_name">Student Management</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
         
          <li><a href="InsertStdData.html">Student Registration</a></li>
          <li><a href="StudentRecord.html">Students Record</a></li>
          <li><a href="StudentNewCardRequests.html">Card Requests</a></li>
        </ul>
      </li>
    
      <li>
        <a href="securityOfficer.html">
          <i class="fas fa-shield"></i>
          <span class="link_name">Security Officer</span>
        </a>
      
      </li>
      <li>
        <a href="setSchoolTiming.html">
          <i class="fas fa-clock"></i>
          <span class="link_name">Set School Timing</span>
        </a>
      </li>
      <li>
        <a href="map.html">
          <i class="fas fa-map-marker-alt"></i>
          <span class="link_name">Select School Area</span>
        </a>
      </li>
      <li>
      </ul>
      <a href="index.html" >
        <div class="profile-details">
          <div class="profile-content">
            <img src="website_log.png" alt="profileImg">
          </div>
          <div class="name-job">
            <div class="profile_name">Admin</div>
            <div class="job">Log out</div>
          </div>
          <i class='bx bx-log-out' style="color: #fff; font-size: 30px;"></i>
        </div>
      </a>

  </div>

  <section class="home-section">

    <nav>
      <div class="profile-details" style="width: 50px;  ">
        <span class="admin_name">Teacher Record <i class="fa fa-table" aria-hidden="true"></i></span>
      </div>
      <div class="logo-details">
     
      
        <img src="website_log.png" alt="Website Logo" style="width: 50px; display: block; margin: 0 auto; ">
  
        <div>
          <span style="display: block; text-align: center; color:black; font-weight: bold;">School Security System</span>
    
        </div>
     
        
      </div>
      <div class="profile-details">

        <span class="admin_name">Admin Pannel <i class="fa fa-user-circle"></i>
        </span>

      </div>
    </nav>

    <div class="home-content">
      <div class="filter-container" style="display: none;">
        <label for="filterType"> </label>
        <select id="filterType">
          <option value="all">All Teachers</option>
          <option value="classTeacher">Class Teachers</option>
          <option value="nonClassTeacher">Non-Class Teachers</option>
        </select>
        <button type="button" id="filterButton">Filter <i class="fa fa-filter"></i></button>
      </div>

      <div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              <th>Class</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="dataBody">
        
          </tbody>
        </table>
      </div>

    </div>
    <style>
   
    </style>
 <script src="./scripts/sidebar.js"></script>
    <script type="module">

      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";
     
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyDCXvbE44rMmYlkSLMIsramC6tiBcLBNH4",
        authDomain: "schoolsecuritysystemusin-4c8fa.firebaseapp.com",
        databaseURL: "https://schoolsecuritysystemusin-4c8fa-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "schoolsecuritysystemusin-4c8fa",
        storageBucket: "schoolsecuritysystemusin-4c8fa.appspot.com",
        messagingSenderId: "58102931592",
        appId: "1:58102931592:web:8b2a5aee4664b3df023f3d",
        measurementId: "G-KTK6CHM7EF"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      // import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
      import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
      import { getAuth, signInWithEmailAndPassword, deleteUser as deleteUserAccount } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
      const db = getDatabase();
      // const idList = document.querySelector("#idList");
      // const idList2 = document.querySelector("#idList2");
      // const dataBody = document.getElementById("dataBody");
      const filterButton = document.getElementById("filterButton");
      const filterType = document.getElementById("filterType");

    
      function filterRecords() {
        const selectedFilter = filterType.value;

        get(ref(db, "TeacherData"))
          .then((snapshot) => {
            dataBody.innerHTML = "";

            if (snapshot.exists()) {
              snapshot.forEach((childSnapshot) => {
                const data = childSnapshot.val();
                const uid = childSnapshot.key;
                const id = data.ID;
                const firName = data.firstname;
                const lasName = data.lastname;
                const Email = data.Email;
                const classTeacher = data.classTeacher;
                const className = data.class;
                const password = data.password;
                const Useruid = data.uid;

                if (
                  (selectedFilter === "all") ||
                  (selectedFilter === "classTeacher" && classTeacher === "yes") ||
                  (selectedFilter === "nonClassTeacher" && classTeacher === "no")
                ) {
                  const tableRow = document.createElement("tr");
                  tableRow.innerHTML = `<td>${id}</td><td>${firName}</td><td>${lasName}</td><td>${Email}</td><td>${className}</td>
                  <td>
                    <div class="button-container"> 
                      <a class="edit-button" href="EditTeacher.html?id=${id}&firstName=${firName}&lastName=${lasName}&email=${Email}&classTeacher=${classTeacher}&className=${className}&password=${password}&uid=${Useruid}">
                                        <button class="action-button edit">Edit <i class='fa fa-edit'></i></button>
                                    </a>
                                    <button id="delete-button" email=${Email} password=${password} data-uid="${uid}"  class="delete-button" data-class="${className}"  data-id="${id}">Delete <i class="fa fa-trash" aria-hidden="true"></i></button>
                                </div>
                                </td>`;
                  dataBody.appendChild(tableRow);
                }
              });

              // Add event listeners for delete buttons
              const deleteButtons = document.querySelectorAll(".delete-button");
              deleteButtons.forEach((button) => {
                button.addEventListener("click", () => {
                  const id = button.getAttribute("data-id");
                  const className = button.getAttribute("data-class");
                  const uid = button.getAttribute("data-uid");
                  const email = button.getAttribute('email');
                  const password = button.getAttribute('password');

              

                  deleteTeacher(id, button, className, uid ,email,password); 
                                                                                // Pass the button element
                });
              });
            }
          })
          .catch((error) => {
            alert(error);
          });
      }

      function deleteAccount(email , password){

        signInWithEmailAndPassword(getAuth(), email, password)
                .then((userCredential) => {
                    // Signed in
                    // var user = userCredential.user;
                    console.log("Sign In Successful!");
                    const user = getAuth().currentUser;
            // alert(user);

            deleteUserAccount(user)
                .then(() => {
                    // User deleted.
                    console.log("User Account Deleted Successfully");
                })
                .catch((error) => {
                    // An error occurred
                    console.error("Error deleting user account:", error);
                });


                    



                    
                })
                .catch((error) => {
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    console.error("Sign In Error:", errorCode, errorMessage);
                });



      }

      function deleteTeacher(id, button, className, uid ,email,password) {

        if (confirm("Are you sure you want to delete this Teacher?")) {

          deleteAccount(email , password);
          // Remove the data from Firebase
          remove(ref(db, "TeacherData/" + uid))

          remove(ref(db, "allowed-card-ids/" + id))
          remove(ref(db, "ClassRoom/" + className + "/ClassTeacher/" + id))

            .then(() => {
              // Remove the row from the table on the webpage
              const rowToDelete = button.closest("tr"); // Find the closest <tr> element
              if (rowToDelete) {
                rowToDelete.remove();
                alert("Teacher record deleted successfully");
              } else {
                alert("Teacher record not found in the table");
              }
            })
            .catch((error) => {
              alert("Error deleting student record: " + error);
            });
        }
      }
      const dropdownButtons = document.querySelectorAll('.nav-dropdown-btn');
    dropdownButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            const content = this.nextElementSibling;
            const isOpen = content.style.display === 'block';
            content.style.display = isOpen ? 'none' : 'block';

            // Store the state in sessionStorage
            const dropdownId = this.getAttribute('data-dropdown-id');
            sessionStorage.setItem(`dropdown-${dropdownId}`, isOpen ? 'closed' : 'open');
        });

        // Check the sessionStorage to set the initial state
        const dropdownId = button.getAttribute('data-dropdown-id');
        const storedState = sessionStorage.getItem(`dropdown-${dropdownId}`);
        if (storedState === 'open') {
            const content = button.nextElementSibling;
            content.style.display = 'block';
            
        }
    });

      
     
      window.addEventListener('load', filterRecords);

      filterButton.addEventListener("click", filterRecords);
      

    </script>
</body>

</html>